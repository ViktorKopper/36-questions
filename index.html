<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>36 Questions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- IMPORTANT: this must exist as /css/style.css -->
  <link rel="stylesheet" href="./css/style.css" />
  <link rel="stylesheet" href="./css/end.css" />
  <link rel="stylesheet" href="./css/merge.css" />
</head>
<body>

  <!-- HEARTS BACKGROUND -->
  <div id="hearts-bg"></div>

   <!-- PLAYER PICK-->
  <div id="role-screen" class="role-screen hidden">
    <div class="role-shell">
      <h1 class="role-title">ğŸ’— 36 Questions</h1>

      <h2>Who are you in this session?</h2>
      <p class="role-sub">
        Choose your role before you begin.<br/>
        Each role sees and unlocks answers differently.
      </p>

      <div class="role-cards">
        <button class="role-card role-a" data-role="A">
          <div class="role-heart">ğŸ’–</div>
          <h3>Iâ€™m Player A</h3>
          <p>Starts the session and answers first.</p>
        </button>

        <button class="role-card role-b" data-role="B">
          <div class="role-heart">ğŸ’œ</div>
          <h3>Iâ€™m Player B</h3>
          <p>Joins the session and responds after.</p>
        </button>
      </div>

      <div class="role-warning">âš ï¸ This choice is permanent for this session.</div>

      <button id="roleContinue" class="btn btn-primary" disabled>
        Continue â†’
      </button>
    </div>
  </div>


  <!-- START SCREEN -->
  <div id="start-screen" class="start-screen">
    <h1>36 Questions</h1>
    <p class="subtitle">A game to fall deeper</p>

    <input id="playerAInput" placeholder="Your name" autocomplete="name" />
    <input id="playerBInput" placeholder="Partner's name" autocomplete="off" />

    <button id="startGame" class="btn btn-primary">Start</button>
  </div>

  <!-- GAME SCREEN (2 PANELS) -->
  <div id="game-layout" class="game-layout hidden">

    <!-- LEFT: MAIN GAME -->
    <div class="app">
      <h1>36 Questions</h1>

      <div class="meta">
        <span id="set"></span>

        <div class="progress-wrap">
          <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="36" aria-valuenow="1">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <div class="progress-label" id="progressLabel">Question 1 / 36</div>
        </div>

        <span id="player"></span>
      </div>

      <div class="card">
        <p id="question"></p>
      </div>

      <div class="answers">
        <label id="myAnswerLabel" class="answer-label">Your answer</label>
        <textarea id="myNote" placeholder="Write your answer..."></textarea>

        <div class="lock-row">
          <button id="lockBtn" class="btn btn-secondary">Lock my answer</button>
          <span id="lockInfo" class="lock-info"></span>
        </div>

        <label id="theirAnswerLabel" class="answer-label">Partner's answer</label>
        <textarea id="theirNote" readonly placeholder="Hidden until both of you lock your answersâ€¦"></textarea>
      </div>

      <div class="controls">
        <button id="prev" class="btn btn-secondary">Previous</button>
        <button id="next" class="btn btn-primary">Next</button>
        <button id="finishBtn" class="btn btn-secondary hidden">Conclusion</button>
        <button id="earlyFinishBtn" class="btn btn-secondary hidden">Conclusion (early)</button>
        <button id="reset" class="btn btn-ghost">Reset</button>
      </div>

      <div class="device-role">
        <span class="device-role__label">This device:</span>

        <div class="device-role__switch" id="deviceRoleSwitch" role="group" aria-label="Device role switch">
          <button class="device-role__btn" id="deviceRoleA" type="button">A</button>
          <button class="device-role__btn" id="deviceRoleB" type="button">B</button>
        </div>

        <span class="device-role__hint" id="deviceRoleHint"></span>
      </div>

      <div class="controls">
        <button id="share" class="btn btn-secondary">Share Session</button>
        <button id="copyLink" class="btn btn-secondary">Copy Link</button>
        <button id="howToBtn" class="btn btn-ghost btn-mini">How to play</button>
        <button id="howMergeBtn" class="btn btn-ghost btn-mini">How merging works</button>


      </div>

      <div class="controls">
        <input id="importLink" placeholder="Paste partner link here..." />
        <button id="importBtn" class="btn btn-secondary">Import</button>
      </div>

      <div id="mergeReport" class="merge-report hidden"></div>

      <p id="shareInfo" class="share-info"></p>
    </div>

    <!-- RIGHT: ANSWERED QUESTIONS -->
    <aside class="answered-panel">
      <div class="answered-head">
        <h2 class="answered-title">Answered questions</h2>
        <div class="answered-legend">
          <span class="dot dot-a"></span> You
          <span class="dot dot-b"></span> Partner
        </div>
      </div>

      <div class="answered-table-wrap">
        <table class="answered-table" id="answeredTable">
          <thead>
            <tr>
              <th>#</th>
              <th>Set</th>
              <th>Question</th>
              <th class="col-small">You</th>
              <th class="col-small">Partner</th>
            </tr>
          </thead>
          <tbody id="answeredTbody"></tbody>
        </table>
      </div>
    </aside>

  </div>

  <!-- END / CONCLUSION SCREEN -->
  <div id="end-screen" class="end-screen hidden">
    <div class="end-panel">
      <div class="end-head">
        <div>
          <h1 class="end-title">Conclusion</h1>
          <p class="end-subtitle" id="endSubtitle">Your answers side-by-side.</p>
        </div>

        <div class="end-actions">
          <button id="endBackBtn" class="btn btn-secondary">Back to game</button>
          <button id="exportPdfBtn" class="btn btn-primary">Export PDF</button>
          <button id="endResetBtn" class="btn btn-ghost">Reset</button>
        </div>
      </div>

      <div class="end-stats" id="endStats"></div>

      <div class="end-filters">
        <label class="chip">
          <input type="checkbox" id="onlyBothLocked" checked />
          <span>Only fully revealed (both locked)</span>
        </label>

        <label class="chip">
          <input type="checkbox" id="includeQuestions" checked />
          <span>Include question text</span>
        </label>
      </div>

      <div id="comparisonList" class="comparison-list"></div>

      <p class="end-hint">
        Tip: when saving as PDF, enable â€œBackground graphicsâ€ in the print dialog so the hearts show up.
      </p>
    </div>
  </div>

  <!-- CONFLICT MODAL -->
  <div id="conflictModal" class="modal hidden" aria-hidden="true">
    <div class="modal-backdrop" id="conflictModalBackdrop"></div>
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="conflictModalTitle">
      <div class="modal-head">
        <h3 id="conflictModalTitle">Resolve conflict</h3>
        <button class="btn btn-ghost" id="conflictModalClose">Close</button>
      </div>
      <div class="modal-body" id="conflictModalBody"></div>
    </div>
  </div>

  <div id="howToModal" class="glass-modal hidden" aria-hidden="true">
    <div class="glass-backdrop" id="howToBackdrop"></div>

    <div class="glass-card">
      <div class="glass-header">
        <h2>How to play â¤ï¸</h2>
        <button id="howToClose" class="btn btn-ghost">Close</button>
      </div>

      <div class="glass-content">
        <ol class="howto-steps">
          <li>Each of us answers privately on your own device âœï¸</li>
          <li>When ready, press <b>Lock my answer</b> ğŸ”’</li>
          <li>Answers stay hidden until <b>both</b> are locked ğŸ‘€</li>
          <li>Use <b>Share / Copy Link</b> to sync  ğŸ”—</li>
          <li>If answers differ, resolve conflicts when importing âš ï¸</li>
          <li>Finish all questions â€” or open <b>Conclusion</b> early (Player A) ğŸ§¾</li>
        </ol>

        <p class="howto-note">
          ğŸ’¡ Tip: This game works best when you donâ€™t rush.  
          Take your time and answer honestly.
        </p>
      </div>
    </div>
  </div>

  <div id="howMergeModal" class="glass-modal hidden" aria-hidden="true">
    <div class="glass-backdrop" id="howMergeBackdrop"></div>

    <div class="glass-card">
      <div class="glass-header">
        <h2>How merging works ğŸ§ </h2>
        <button id="howMergeClose" class="btn btn-ghost">Close</button>
      </div>

      <div class="glass-content">
        <h3 style="margin: 0 0 10px; opacity:.95;">Rules</h3>
        <ol class="howto-steps">
          <li>Your game lives only in your browser ğŸ’¾</li>
          <li>Import merges answers â€” it doesnâ€™t blindly overwrite ğŸ”„</li>
          <li><b>Locked</b> answers have priority over unlocked ğŸ”’</li>
          <li>Empty fields may be auto-filled âœï¸</li>
          <li>If both sides wrote different text â†’ <b>conflict</b> âš ï¸</li>
          <li>You choose: <b>Keep mine</b> or <b>Keep theirs</b> âœ…</li>
        </ol>

        <h3 style="margin: 16px 0 10px; opacity:.95;">Examples</h3>

        <div style="display:grid; gap:10px;">
          <div style="padding:10px; border-radius:14px; background:rgba(0,0,0,.28); border:1px solid rgba(236,72,153,0.18);">
            <div style="opacity:.85; font-weight:700; margin-bottom:6px;">1) Empty gets filled</div>
            <div style="opacity:.85;">
              <b>You:</b> (empty) <br/>
              <b>Partner:</b> â€œI miss you when youâ€™re quiet.â€ <br/>
              âœ… Result: your empty field is filled with partnerâ€™s answer (no conflict).
            </div>
          </div>

          <div style="padding:10px; border-radius:14px; background:rgba(0,0,0,.28); border:1px solid rgba(236,72,153,0.18);">
            <div style="opacity:.85; font-weight:700; margin-bottom:6px;">2) Locked wins over unlocked</div>
            <div style="opacity:.85;">
              <b>You (locked):</b> â€œBeach + sunset + no phone.â€ <br/>
              <b>Partner (unlocked):</b> â€œMountains + coffee.â€ <br/>
              âœ… Result: locked answer stays. (No overwrite by unlocked.)
            </div>
          </div>

          <div style="padding:10px; border-radius:14px; background:rgba(0,0,0,.28); border:1px solid rgba(236,72,153,0.18);">
            <div style="opacity:.85; font-weight:700; margin-bottom:6px;">3) Both wrote different text (unlocked)</div>
            <div style="opacity:.85;">
              <b>You:</b> â€œI want more honesty.â€ <br/>
              <b>Partner:</b> â€œI want more patience.â€ <br/>
              âš  Result: conflict appears â†’ you choose which to keep.
            </div>
          </div>

          <div style="padding:10px; border-radius:14px; background:rgba(0,0,0,.28); border:1px solid rgba(236,72,153,0.18);">
            <div style="opacity:.85; font-weight:700; margin-bottom:6px;">4) Both locked but different</div>
            <div style="opacity:.85;">
              <b>You (locked):</b> â€œMy perfect day is calm at home.â€ <br/>
              <b>Partner (locked):</b> â€œMy perfect day is exploring a city.â€ <br/>
              âš  Result: conflict appears (because both are locked but different) â†’ you choose.
            </div>
          </div>
        </div>

        <p class="howto-note">
          ğŸ’¡ Tip: Conflicts are normal when both of you answer offline.
          Nothing is deleted without you choosing.
        </p>
      </div>
    </div>
  </div>



  <!-- Order matters -->
  <script src="./js/questions.js"></script>
  <script src="./js/utils.js"></script>
  <script src="./js/store.js"></script>
  <script src="./js/session.js"></script>
  <script src="./js/hearts.js"></script>

  <script src="./js/pdf-export.js"></script>
  <script src="./js/endgame.js"></script>
  <script src="./js/app.js"></script>
</body>
</html>
